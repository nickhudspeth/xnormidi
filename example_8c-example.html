<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>xnor_midi: example.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>example.c</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;midi_usb.h&quot;</span> <span class="comment">//see the lufa_midi implementation</span>

<span class="comment">//echo data back</span>
<span class="keywordtype">void</span> fallthrough_callback(<a name="_a0"></a><a class="code" href="struct__midi__device.html" title="This structure represents the input and output functions and processing data for a midi device...">MidiDevice</a> * device, uint16_t cnt, uint8_t byte0, uint8_t byte1, uint8_t byte2){
   <a name="a1"></a><a class="code" href="group__send__functions.html#ga36e2f2e45369d911b76969361679054b" title="Send up to 3 bytes of data.">midi_send_data</a>(device, cnt, byte0, byte1, byte2);
}

<span class="keywordtype">void</span> cc_callback(<a class="code" href="struct__midi__device.html" title="This structure represents the input and output functions and processing data for a midi device...">MidiDevice</a> * device, uint8_t chan, uint8_t num, uint8_t val) {
   <span class="comment">//sending it back on the next channel</span>
   <a name="a2"></a><a class="code" href="group__send__functions.html#gaaf884811c92df405ca8fe1a00082f960" title="Send a control change message (cc) via the given device.">midi_send_cc</a>(device, (chan + 1) % 16, num, val);
}

<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {
   <a class="code" href="struct__midi__device.html" title="This structure represents the input and output functions and processing data for a midi device...">MidiDevice</a> midi_device;

   <span class="comment">//setup the device</span>
   midi_usb_init(&amp;midi_device);

   <span class="comment">//register callbacks</span>
   <a name="a3"></a><a class="code" href="group__input__callback__reg.html#ga7ed189164aa9682862b3181153afbd94" title="Register fall through callback.">midi_register_fallthrough_callback</a>(&amp;midi_device, fallthrough_callback);
   <a name="a4"></a><a class="code" href="group__input__callback__reg.html#ga64ab672abbbe393c9c4a83110c8df718" title="Register a control change message (cc) callback.">midi_register_cc_callback</a>(&amp;midi_device, cc_callback);

   <span class="comment">//send some messages</span>
   <a class="code" href="group__send__functions.html#gaaf884811c92df405ca8fe1a00082f960" title="Send a control change message (cc) via the given device.">midi_send_cc</a>(&amp;midi_device, 0, 1, 2);

   <a name="a5"></a><a class="code" href="group__send__functions.html#ga467bcf46dbf03ec269ce565b46bc2775" title="Send a note on message via the given device.">midi_send_noteon</a>(&amp;midi_device, 0, 64, 127);
   <a name="a6"></a><a class="code" href="group__send__functions.html#gaedb7d8805425eef5d47d57ddcb4c7a49" title="Send a note off message via the given device.">midi_send_noteoff</a>(&amp;midi_device, 0, 64, 127);

   <span class="keywordflow">while</span>(1){
      <span class="comment">//processes input from the midi device and calls the appropriate callbacks</span>
      <a name="a7"></a><a class="code" href="group__midi__device__setup__process.html#gaa3d5993d0e998a1b59bbf5ab9c7b492b" title="Process input data.">midi_device_process</a>(&amp;midi_device);
   }

   <span class="keywordflow">return</span> 0; <span class="comment">//never happens</span>
}
</pre></div> </div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Apr 20 2011 12:54:52 for xnor_midi by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
